# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура.

Приложение спроектированно в соответствии с архитектурой `MVP`.

- `Model` - Слой для управления данными и взаимодействия с сервером.
- `View` - Слой отображения данных и обработка пользовательских действий.
- `Presenter` - Слой соединяет `Model` и `View`.

## Базовый код.

### Класс Api.

Класс `Api` предназначен для работы с сервером через HTTP-запросы. Его основная задача — предоставить удобные методы для отправки запросов и обработки ответов. Основные методы:

- Конструктор: Принимает базовый URL и дополнительные настройки запросов.
- `get` выполняет запрос по указанному URI. Возвращает данные, полученные от сервера, в формате JSON. Если запрос не удался, возвращает ошибку.
- `post` выполняет запрос для создания или изменения данных на сервере. Поддерживает методы POST, PUT и DELETE. Принимает URI, данные в формате объекта и тип метода.
- `handleResponse` обрабатывает ответ сервера. Если запрос успешен, преобразует ответ в JSON. В случае ошибки возвращает сообщение об ошибке из ответа сервера или текстовый статус ошибки.

### Класс EventEmitter.

Класс `EventEmitter` реализует брокер событий, позволяя компонентам приложения обмениваться данными без прямой связи друг с другом. Этот подход улучшает модульность и изоляцию компонентов. Основные методы:

- `on` позволяет подписаться на событие. Если событие с указанным именем ещё не зарегистрировано, оно создаётся.
- `off` удаляет указанного подписчика с события. Если у события больше нет подписчиков, оно удаляется.
- `emit` генерирует событие с указанными данными. Все подписчики события (или соответствующие шаблону) будут уведомлены.
- `onAll` позволяет подписаться на все события. Полезно для отладки или ведения логов.
- `offAll` удаляет всех подписчиков для всех событий.
- `trigger` создаёт функцию, которая генерирует указанное событие при вызове. Это удобно для создания автоматически инициируемых событий.

### Класс Component.

Класс `Component` предназначен для работы с DOM в веб-приложениях. Класс содержит базовый функционал для управления HTML-элементами, включая управление стилями, текстом, состояниями блокировки и отображения, а также рендеринг данных. Он используется как основа для создания дочерних компонентов.
Конструктор: принимает на вход `container` типа `HTMLElement`.

- `toggleClass` добавляет, удаляет или переключает CSS-класс для указанного элемента.
- `setText` устанавливает текстовое содержимое элемента.
- `setDisabled` управляет состоянием блокировки элемента (disabled).
- `setHidden` cкрывает элемент, устанавливая его стиль `display: none`.
- `setVisible` делает элемент видимым, удаляя стиль `display: none`.
- `setImage` устанавливает источник изображения и альтернативный текст для элемента `<img>`.
- `render` основной метод рендеринга. Передаёт данные в экземпляр компонента и возвращает корневой элемент `container`.

### Класс Model.

класс `Model` предназначен для работы с данными и их изменениями. Класс включает базовый функционал для управления состоянием модели и оповещения подписчиков об изменениях.
Конструктор принимает: Данные модели (data), которые копируются в экземпляр класса и обработчик событий (events), который используется для оповещения об изменениях.

- `emitChanges` Оповещает подписчиков о том, что состояние модели изменилось.

## Данные и типы, используемые в проекте.

### Интерфейс карточек товара.

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

### Описание данных в полях оформления заказа.

```
interface IContactInfo {
  payment: string;
  address: string;
  email: string;
  phone: string;
}
```

### Модель списка карточек товаров на главной странице.

```
interface IProductData {
  total: number;
  items: IProduct[];
}
```

### Модель списка карточек товаров в корзине.

```
interface IOrderData {
  items: HTMLElement[];
  total: number;
}
```

## Слой Данных.

### Класс LarekApi.
`LarekApi` основной класс работы с сервером в проекте. Расширяет базовый класс `Api`.

Поля:

`cdn` входящий url.

Методы:

* `getProductItems` получение списка товаров с сервера.
* `orderProductsResponse` отправка данных заказа на сервер.

### Класс AppData.
Модель данных приложения. Этот класс отвечает за хранение, логику работы с данными и методы работы с ними.

Поля:
* `items: IProduct[]` массив с карточками товаров.
* `preview: string` предварительный просмотр товара.
* `basket: IProduct[]` массив для хранения товаров добавленных в корзину.
* `userData: IContactInfo` свойство харнит информацию о пользователе.
* `formErrors: FormErrors` свойство исп для хранения ошибок в форме валидации.

Методы:
* `getUserData` получение данных пользователя.
* `getProducts` метод для получения списка карточек.
* `setPreview` метод предпросмотра.
* `getBasketI` метод получения списка ID товаров в корзине.
* `addBasket` метод добавления в корзину.
* `getItemById` метод получения элемента по ID.
* `deleteBasket` метод удаления из корзины.
* `setItems` метод получения списка.
* `getBasket` возвращает массив товаров в корзине.
* `getItems` получает список товаров.
* `clearBasket` очищает корзину.
* `getTotalBasket` получение общей стоимости корзины.
* `getCountBasket` возвращает общее количество товаров в корзине.
* `validateContact` проверяет корректность контактных данных.
* `clearOrder` очищает данные заказа.
* `getFormErrors` получение ошибок формы.
* `getField` получение полей.
* `addOrderField` метод для заполнения полей `email`, `phone`, `address`, `payment`.
* `hasProductInBasket` проверяет наличие товара в корзине.

## Слой представления.

### Класс Page.

Класс `Page` управляет отображением карточек товаров на главной странице, а также кнопкой корзины и счетчиком товаров в корзине. Предоставляет методы для добавления карточек в контейнер и обновления счетчика корзины.Конструктор принимает корневой элемент страницы, контейнер для карточек товаров, кнопку корзины и элемент для счетчика товаров на кнопке корзины.

Поля:
* `mainPage: HTMLElement` корневой элемент главной страницы.
* `container: HTMLElement` контейнер для размещения карточек товаров.
* `basketBtn: HTMLElement` элемент кнопки корзины
* `basketCounter: HTMLElement` элемент для отображения количества товаров в корзине.
* `event: IEvent` объект для генерации событий при изменениях в корзине.

Методы:
* `set containerElement(newContainer)` сеттер для обновления контейнера.
* `set basketCounterElement(newBasketCounter)` сеттер для обновления счетчика.

### Класс CardPreview.
Класс `CardPreview` управляет отображением карточки товара, в которую входят данные о категории, названии, описании, изображении, цене и кнопка "Заказать" с проверкой наличия товара в корзине. Конструктор класса принимает DOM-элемент шаблона, что позволяет формировать карточки разных вариантов. В классе устанавливаются слушатели на все интерактивные элементы для генерации событий при взаимодействии пользователя.

Поля:
* `templateElement: HTMLElement` — шаблон карточки товара.
* `event: IEvent` — объект для генерации событий.
* элементы разметки карточки.

Методы:
* `setData(cardData: IProduct)` сеттер для заполнения карточки товара.
* `render()` возвращает заполненную карточку с установленными слушателями.

### Класс Modal
Класс `Modal` управляет отображением модальных окон. В нем описаны методы `open` и `close` для управления отображением модального окна, `render` для отрисовки данных контента. Класс обеспечивает закрытие модалки с помощью нажатия на кнопку закрытия (крестик), оверлей, кнопка "ESC". Конструктор принимает селектор для идентификации модального окна на странице, разметку кнопки закрытия модального окна и экземпляр класса `EventEmitter` для генерации событий.

Поля:
* `modal: HTMLElement` элемент модального окна.
* `closeButton: HTMLElement` разметка кнопки закрытия модального окна.
* `event: IEvents` объект для генерации событий.

Методы:
* `open(content: HTMLElement)` открывает модальное окно.
* `close()` закрывает модальное окно.
* `render()` отображает данные контента.

### Класс Basket
Класс `Basket` управляет отображением корзины товаров в модальном окне и взаимодействием с её содержимым. Корзина отображает список добавленных товаров, их стоимость, общую cумму. Также включает кнопку для оформления заказа.

Поля:
* `listProducts: HTMLUListElement` контейнер для списка товаров в корзине.
* `totalPrice: HTMLElement` элемент для отображения общей стоимости товаров.
* `eventEmitter: EventEmitter` объект для генерации событий при изменениях в корзине.

Методы:
* `order(data: IProduct[])` добавляет товары в корзину, используя шаблон.
* `removeProduct(productId: string)` удаляет товар из корзины по его идентификатору.
* `render()` перерисовывает содержимое модального окна корзины, отображая актуальный список товаров и общую стоимость.

### Класс Form
Класс `Form` управляет работой форм в приложении, а также за валидацию введённых данных,контролирует состояние кнопки отправки и генерирует события при отправке данных.

Поля:
* `formElement: HTMLFormElement` элемент формы, выбранный по селектору или загруженный из шаблона.
* `event: IEvent` объект для генерации событий, таких как отправка формы.
* `submitButton: HTMLButtonElement` кнопка отправки формы, активируемая при корректном заполнении обязательных полей.

Методы:
* `isValid()` Проверяет, заполнены ли все обязательные поля формы. Используется для активации кнопки отправки.
* `clear()` Очищает содержимое формы и деактивирует кнопку отправки.

### Класс Order
Класс `Order` управляет отображением способа оплаты и адреса доставки в модальном окне.Конструктор принимает `container` типа `HTMLElement`, передавая `container` в родительский конструктор и объект `event` типа `IEvents`.

Поля: `button` хранит разметку кнопок формы оплаты.

Методы:
* `set payment` устанавливает значение payment.
* `set address` устанавливает значение поля адрес.

### Contacts
Класс `Contacts` управляет отображением контактной информации покупателя в соответствующем модальном окне.Конструктор принимает `container` типа `HTMLElement`, передавая `container` в родительский конструктор и объект `event` типа `IEvents`.

Методы:
* `set phone` устанавливает значение поля телефона.
* `set email` устанавливает значение поля почты.

### Класс Success
Класс `Success` управляет модальным окном, которое отображает сообщение об успешном завершении покупки.

Поля: `totalAmount: HTMLElement` разметка общей суммы товаров в заказе.

Методы: `set Total` установка значения общей суммы.
