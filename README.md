# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура.

Приложение спроектированно в соответствии с архитектурой `MVP`.

- `Model` - Слой для управления данными и взаимодействия с сервером.
- `View` - Слой отображения данных и обработка пользовательских действий.
- `Presenter` - Слой соединяет `Model` и `View`.

## Базовый код.

### Класс Api.

Класс `Api` предназначен для работы с сервером через HTTP-запросы. Его основная задача — предоставить удобные методы для отправки запросов и обработки ответов. Основные методы:

- Конструктор: Принимает базовый URL и дополнительные настройки запросов.
- `get` выполняет запрос по указанному URI. Возвращает данные, полученные от сервера, в формате JSON. Если запрос не удался, возвращает ошибку.
- `post` выполняет запрос для создания или изменения данных на сервере. Поддерживает методы POST, PUT и DELETE. Принимает URI, данные в формате объекта и тип метода.
- `handleResponse` обрабатывает ответ сервера. Если запрос успешен, преобразует ответ в JSON. В случае ошибки возвращает сообщение об ошибке из ответа сервера или текстовый статус ошибки.

### Класс EventEmitter.

Класс `EventEmitter` реализует брокер событий, позволяя компонентам приложения обмениваться данными без прямой связи друг с другом. Этот подход улучшает модульность и изоляцию компонентов. Основные методы:

- `on` позволяет подписаться на событие. Если событие с указанным именем ещё не зарегистрировано, оно создаётся.
- `off` удаляет указанного подписчика с события. Если у события больше нет подписчиков, оно удаляется.
- `emit` генерирует событие с указанными данными. Все подписчики события (или соответствующие шаблону) будут уведомлены.
- `onAll` позволяет подписаться на все события. Полезно для отладки или ведения логов.
- `offAll` удаляет всех подписчиков для всех событий.
- `trigger` создаёт функцию, которая генерирует указанное событие при вызове. Это удобно для создания автоматически инициируемых событий.

### Класс Component.

Класс `Component` предназначен для работы с DOM в веб-приложениях. Класс содержит базовый функционал для управления HTML-элементами, включая управление стилями, текстом, состояниями блокировки и отображения, а также рендеринг данных. Он используется как основа для создания дочерних компонентов.
Конструктор: принимает на вход `container` типа `HTMLElement`.

- `toggleClass` добавляет, удаляет или переключает CSS-класс для указанного элемента.
- `setText` устанавливает текстовое содержимое элемента.
- `setDisabled` управляет состоянием блокировки элемента (disabled).
- `setHidden` cкрывает элемент, устанавливая его стиль `display: none`.
- `setVisible` делает элемент видимым, удаляя стиль `display: none`.
- `setImage` устанавливает источник изображения и альтернативный текст для элемента `<img>`.
- `render` основной метод рендеринга. Передаёт данные в экземпляр компонента и возвращает корневой элемент `container`.

### Класс Model.

класс `Model` предназначен для работы с данными и их изменениями. Класс включает базовый функционал для управления состоянием модели и оповещения подписчиков об изменениях.
Конструктор принимает: Данные модели (data), которые копируются в экземпляр класса и обработчик событий (events), который используется для оповещения об изменениях.

- `emitChanges` Оповещает подписчиков о том, что состояние модели изменилось.

## Данные и типы, используемые в проекте.

### Интерфейс карточек товара.

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

### Описание данных в полях оформления заказа.

```
interface IContactInfo {
  payment: string;
  address: string;
  email: string;
  phone: string;
}
```

### Модель списка карточек товаров на главной странице.

```
interface IProductData {
  total: number;
  items: IProduct[];
}
```

### Модель списка карточек товаров в корзине.

```
interface IOrderData {
  items: HTMLElement[];
  total: number;
}
```

## Слой Данных.

### Класс LarekApi.
`LarekApi` основной класс работы с сервером в проекте. Расширяет базовый класс `Api`.

Поля:
`cdn` входящий url.

Методы:

- `getProductsList` получение списка товаров с сервера.
- `postOrder` отправка данных заказа на сервер.

### Класс AppState.
Модель данных приложения. Этот класс отвечает за хранение, логику работы с данными и методы работы с ними.

Поля:
- `items: IProduct[]` массив с карточками товаров.
- `preview: string` предварительный просмотр товара.
- `basket: IProduct[]` массив для хранения товаров добавленных в корзину.
- `userData: IContactInfo` свойство харнит информацию о пользователе.
- `formErrors: FormErrors` свойство исп для хранения ошибок в форме валидации.

Методы:
- `addProducts` добавление массива товаров в модель.
- `getProducts` метод для получения списка карточек товаров.
- `getUserData` получение данных пользователя.
- `setPreview` метод предпросмотра.
- `getCardById` получение карточки по ID.
- `getBasket` возвращает массив товаров в корзине.
- `getIdProductsBasket` получение списка ID товаров в корзине.
- `addToBasket` метод добавления в корзину.
- `deleteFromBasket` метод удаления из корзины.
- `hasProductInBasket` проверка наличия товара в корзине.
- `clearBasket` очищает корзину.
- `getTotalBasket` получение общей стоимости корзины.
- `getBasketCounter` возвращает общее количество товаров в корзине.
- `getFormErrors` получение ошибок формы.
- `getPaymentField` метод получения полей c выбором типа оплаты.
- `fillContactInfo` метод для заполнения полей с контактными данными пользователя.
- `validateContact` проверяет корректность контактных данных.
- `reset` метод очистки корзины после заказа.

## Слой представления.

### Класс Page.
Класс `Page` управляет отображением карточек товаров на главной странице, а также кнопкой корзины и счетчиком товаров в корзине. Предоставляет методы для добавления карточек в контейнер, обновления счетчика корзины и метод позволяющий выключить/включить прокрутку страницы. Конструктор принимает `container` с типом `HTMLElement`, в также объект `events` с типом `IEvents`.

Поля:
- `counter: HTMLElement` разметка счетчика товаров в корзине.
- `gallery: HTMLElement` контейнер для размещения карточек товаров.
- `wrapper: HTMLElement` обертка главной страницы.
- `basket: HTMLElement` элемент кнопки корзины.

Методы:
- `set counter(value: number)` сеттер для отображения счетчика корзины.
- `set gallery(items: HTMLElement[])` сеттер для отображения карточек товаров в контейнере.
- `set locked(value: boolean)` сеттер для установки класса, который блокирует прокрутку страницы (используется в момент открытия модальных окон).

### Класс Card.
Класс `Card` представляет карточку товара с возможностью отображения информации и обработки действий пользователя. В нем описаны методы для настройки заголовка, цены, кнопки, а также возможность обработки событий клика. Конструктор принимает container с типом HTMLElement, представляющий корневой элемент карточки, и необязательный объект actions с типом ICardActions.

Поля:
- `title: HTMLElement` элемент заголовка карточки.
- `price: HTMLElement` элемент отображения цены товара.
- `button: HTMLButtonElement` элемент кнопки действия.

Методы:
- `set button(value: string)` сеттер изменяет текст кнопки действия.
- `set id(value: string)` сеттер устанавливает уникальный идентификатор для карточки через атрибут data-id контейнера.
- `set price(value: string)` сеттер устанавливает текст цены карточки. Если передано значение null, отображается текст "Бесценно".
- `set title(value: string)` сеттер устанавливает текст заголовка карточки.

### Класс CardPage.
Класс `CardPage` представляет карточку товара для отображения на главной странице. Он расширяет функциональность класса `Card`, добавляя работу с изображением и категорией товара. Конструктор принимает `container` с типом `HTMLElement`, представляющий корневой элемент карточки, и необязательный объект `actions` с типом `ICardActions`.

Поля:
- `image: HTMLImageElement` элемент изображения карточки.
- `category: HTMLElement` элемент отображения категории товара.

Методы:
- `set image(value: string)` сеттер устанавливает изображение карточки. Использует метод `setImage`, передавая элемент изображения, `URL` изображения и заголовок карточки в качестве альтернативного текста.
- `set category(value: TCategory)` сеттер задает категорию карточки. Устанавливает текст категории и применяет соответствующий класс из объекта `categoryList`.

### Класс CardPreview.
Класс `CardPreview` представляет карточку товара с дополнительным элементом описания. Он расширяет функциональность класса `CardPage`, добавляя работу с текстовым описанием товара. Конструктор принимает `container` с типом `HTMLElement`, представляющий корневой элемент карточки, и необязательный объект `actions` с типом `ICardActions`.

Поля:
- `description: HTMLElement`  элемент для отображения текстового описания товара.

Методы:
- `set description(value: string)` сеттер устанавливает текст описания товара, используя метод `setText`.

### Класс CardBasket.
Класс `CardBasket` представляет карточку товара, отображаемую в корзине. Он расширяет базовый класс `Card`, добавляя функциональность для работы с индексом позиции товара в корзине. Конструктор принимает `container` с типом `HTMLElement`, представляющий корневой элемент карточки, и необязательный объект `actions` с типом `ICardActions`.

Поля:
- `index: HTMLElement` элемент для отображения индекса товара в корзине.

Методы:
- `set index(value: number)` устанавливает индекс товара в корзине, преобразуя числовое значение в строку и отображая его с помощью метода `setText`.

### Класс Modal.
Класс `Modal` управляет отображением модальных окон. В нем описаны методы `open` и `close` для управления отображением модального окна, `render` для отрисовки данных контента. Класс обеспечивает закрытие модалки с помощью нажатия на кнопку закрытия (крестик), оверлей, кнопка "ESC". Конструктор принимает `container` с типом `HTMLElement`, в также объект `events` с типом `IEvents`.

Поля:
- `closeButton: HTMLElement` разметка кнопки закрытия модального окна.
- `content: HTMLElement` разметка контейнера для контента модального окна.

Методы:
- `open()` открывает модальное окно.
- `close()` закрывает модальное окно.
- `render()` отображает данные контента.

### Класс Basket.
Класс `Basket` управляет отображением корзины товаров в модальном окне и взаимодействием с её содержимым. Корзина отображает список добавленных товаров, их стоимость, общую cумму. Также включает кнопку для оформления заказа. Конструктор принимает `container` с типом `HTMLElement`, в также объект `events` с типом `IEvents`.


Поля:
- `basketList: HTMLElement` контейнер для списка товаров в корзине.
- `basketTotal: HTMLElement` элемент для отображения общей стоимости товаров.
- `button: HTMLElement` кнопка для прехода к оформлению.

Методы:
- `set list(items: HTMLElement[])` сеттер добавляет товары в корзину.
- `set total(total: number)` сеттер устанавливает числовое значение суммы товаров.

### Класс Form.
Класс `Form` управляет работой форм в приложении, контролирует состояние кнопки отправки и генерирует события при отправке данных. Конструктор принимает `container` с типом `HTMLElement`, в также объект `events` с типом `IEvents`.

Поля:
- `submit: HTMLButtonElement` разметка кнопки сабмита.
- `errors: HTMLElement` разметка вывода ошибок.

Методы:
- `onInputChange(field: keyof T, value: string)` уобрабатывает изменение значения поля ввода. Вызывает событие вида `<имя_формы>.<имя_поля>:change`, передавая данные об изменении.
- `set valid(value: boolean)` сеттер включает или отключает кнопку отправки в зависимости от валидности формы.
- `set errors(value: string)` сеттер устанавливает текст ошибки
- `render(state: Partial<T> & IFormState)` обновляет состояние формы, включая валидность, ошибки и значения полей.

### Класс Order.
Класс `Order` управляет формой оформления заказа. Он расширяет функциональность класса `Form`, добавляя методы для управления выбором способа оплаты и установки адреса доставки. Конструктор принимает `container` с типом `HTMLFormElement`, представляющий корневой элемент формы, и `events` с типом `IEvents` для работы с событиями.

Поля: 
- `cashButton: HTMLButtonElement` кнопка выбора оплаты наличными.
- `cardButton: HTMLButtonElement` кнопка выбора оплаты картой.

Методы:
- `set payment(value: string)` сеттер обновляет состояние кнопок оплаты. Применяет класс активности `.button_alt-active` к соответствующей кнопке в зависимости от выбранного способа оплаты.
- `disableButtons()` отключает обе кнопки оплаты, убирая класс активности `.button_alt-active`.
- `set address(value: string)` сеттер устанавливает значение адреса доставки в соответствующее поле ввода формы.

### Contacts.
Класс `Contacts` управляет формой контактной информации, расширяя функциональность класса `Form` для работы с полями телефона и email. Конструктор принимает `container` с типом `HTMLFormElement`, представляющий корневой элемент формы, и `events` с типом `IEvents` для работы с событиями.

Методы:
- `set phone(value: string)` устанавливает значение поля телефона.
- `set email(value: string)` устанавливает значение поля почты.

### Класс Success.
Класс `Success` управляет модальным окном, которое отображает сообщение об успешном завершении покупки. Конструктор принимает `container` с типом `HTMLElement`, в также объект `events` с типом `IEvents`.

Поля: 
- `total: HTMLElement` разметка общей суммы товаров в заказе.

Методы: 
- `set total` сеттер установливает значение общей суммы товаров.
